<!doctype html>
<ul id="leaderboard"></ul>
<script src="/socket.io/socket.io.js"></script>
<script>
  var list = document.getElementById("leaderboard")
  var socket = io("http://localhost:8080")

  socket.on("state", function (data) {
    var state = data["NodeBot Workshop"]
    if (!state) return;
    
    console.log("Got new state", state)

    var students = Object.keys(state).map(function (ip) {
      return {ip: ip, count: state[ip].length, last: state[ip][state[ip].length - 1]}
    }).sort(function (a, b) {
      if (a.count < b.count) {
        return -1
      } else if (a.count > b.count) {
        return 1
      }
      return 0
    })

    list.innerHTML = ""

    students.forEach(function (s) {
      var item = document.createElement("li")
      
      var ip = document.createElement("span")
      ip.className = "ip"
      ip.innerText = s.ip
      
      item.append(ip)

      var count = document.createElement("span")
      ip.className = "count"
      ip.innerText = s.count

      item.append(count)

      var last = document.createElement("span")
      ip.className = "last"
      ip.innerText = s.last

      item.append(last)
    })
  })
</script>